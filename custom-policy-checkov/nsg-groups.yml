---
metadata:
  name: "Disallow High Risk Ports - NSG Groups"
  id: "CKV_CUSTOM_1"
  category: "Infrastructure as Code"
  severity: "CRITICAL"

definition:
 not:
    and:
          - cond_type: "attribute"
            resource_types:
              - "azurerm_network_security_group"
            attribute: "direction"
            operator: "equals"
            value: "Inbound"
          - cond_type: "attribute"
            resource_types:
              - "azurerm_network_security_group"
            attribute: "access"
            operator: "equals"
            value: "Allow"
          - cond_type: "attribute"
            resource_types:
              - "azurerm_network_security_group"
            attribute: "source_address_prefix"
            operator: "within"
            value: 
             - "Internet"
             - "VirtualNetwork"
             - "*"
          - cond_type: "attribute"
            resource_types:
              - "azurerm_network_security_group"
            attribute: "destination_port_range"
            operator: "within"
            value: 
             - "3389"
             - "22"
             - "*"